"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4605],{22481:(e,t,s)=>{s.d(t,{Z:()=>p});var i=s(2991),l=s.n(i);const a=e=>{let{instructionURL:t,scene:s,width:i}=e;const l=(new Date).getTime();let a="https://rendering.documents.cimpress.io/v1/cse/preview";return a+="?width=".concat(i),a+="&instructions_uri=".concat(encodeURIComponent(t)),a+="&scene=".concat(encodeURIComponent(s)),a+="&timestamp=".concat(l),a};var o=s(17616),n=s(19017);const c=async e=>{var t;let s;try{e&&(s=await axios.get(e))}catch(e){n.Z.error(e)}return null===(t=s)||void 0===t?void 0:t.data},{GALLERY_SIZE:d,PREVIEW_SIZE:m}=o.Z,p=async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m;const o=await c(e);if(o&&null!=o&&o.renderingInstructionsUrl){const c=null==t?void 0:t.defaultScene,d=null==t?void 0:t.gallery,m=l()(d).call(d,(e=>({...e,url:a({instructionURL:null==o?void 0:o.renderingInstructionsUrl,scene:e.scene,width:s})})));let p;var n;if(c)p=a({instructionURL:null==o?void 0:o.renderingInstructionsUrl,scene:c,width:i});else p=m&&m.length?null===(n=m[0])||void 0===n?void 0:n.url:null;return{...t,previewUrl:p,gallery:m,udsUrl:e}}return null}},17616:(e,t,s)=>{s.d(t,{Z:()=>i});const i={GALLERY_SIZE:800,PREVIEW_SIZE:400}},130:(e,t,s)=>{s.r(t),s.d(t,{default:()=>u});var i=s(94473),l=s.n(i),a=s(59340),o=s.n(a),n=(s(33948),s(20629)),c=s(17616),d=s(22481),m=s(48383);const{GALLERY_SIZE:p,PREVIEW_SIZE:r}=c.Z,h={name:"TemplateFeaturesList",props:["customStyle","editViewTemplateData","validating","hasDesignSelection","customConfigurationItem"],components:{TemplateSelect:()=>Promise.all([s.e(1412),s.e(4252)]).then(s.bind(s,77163)),TemplateGallery:()=>Promise.all([s.e(6153),s.e(6450),s.e(222),s.e(4647)]).then(s.bind(s,92960))},data:()=>({getTemplateAssetsUrl:"/product/get-template-assets/",getTemplateCollectionsUrl:"/product/get-template-collections/",templateSelectedCollection:"",templateAssets:[],originalTemplateAssets:[],loadingTemplateAssets:!1,templateCollections:{},prevUserSelection:{},fetchingTemplates:!1,gallerySize:p,previewSize:r,isFirstValidation:!0,editViewGalleryId:"",editViewTemplateId:""}),computed:{...(0,n.Se)("product",["mcpSku","userSelection","merchantProductName","templateSelectedAsset","completeSelection","customTemplateUds","isEditView","isCustomTemplateSelected"])},methods:{updateSelectedCollection(e){var t;const s=l()(t=this.templateCollections).call(t,(t=>t.id===e));if(""===e||!s){var i;const e=l()(i=this.templateCollections).call(i,(e=>!0===e.isDefault));return e?e.id:this.templateCollections[0].id}return e},async onTemplateSelectionChanged(e,t){t&&""!==t&&(this.fetchingTemplates=!0,this.$store.dispatch("product/setDocumentReferenceUrl",null),this.$store.dispatch("product/setCustomTemplateUds",{}),await this.getTemplateAssets(e),(0,m.Z)("Hit From Template Asset","ga_event",{type:"Hit product page",action:this.merchantProductName,label:"Features",NonInteraction:!1}),this.$nextTick((()=>{this.fetchingTemplates=!1})))},async setTemplateAssetAsSelected(e){var t;await this.$store.dispatch("product/setTemplateSelection",{templateSelectedAsset:e,collectionId:this.templateSelectedCollection}),e&&e.isCustom&&this.isEditView&&e.id===(null===(t=this.editViewTemplateData)||void 0===t?void 0:t.id)&&await this.updateCustomTemplate(this.editViewTemplateData.url)},async onTemplateAssetChanged(e){await this.setTemplateAssetAsSelected(e)},async restoreDefaultCustomTemplate(){this.originalTemplateAssets&&await this.setTemplateAssetAsSelected(this.originalTemplateAssets[0])},async getTemplateAssets(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.templateSelectedCollection=this.updateSelectedCollection(e);const i={mcpSku:this.mcpSku,cId:this.templateSelectedCollection,attributes:this.userSelection};if(o()(this.prevPayload)!==o()(i)||s){this.loadingTemplateAssets=!0,this.prevPayload=i;try{const e=await axios.post(this.getTemplateAssetsUrl,i);if(200===e.status&&e.data.length>0){var a;let i;var n;if(this.templateAssets=e.data,this.originalTemplateAssets=e.data,(this.isEditView||this.customConfigurationItem||s)&&t)i=l()(n=this.templateAssets).call(n,(e=>e.id===t));const o=null!==(a=i)&&void 0!==a?a:this.templateAssets[0];await this.onTemplateAssetChanged(o)}}catch(e){console.log(e)}this.loadingTemplateAssets=!1}},async getTemplateCollections(){try{const e=await axios.post(this.getTemplateCollectionsUrl,{mcpSku:this.mcpSku,attributes:this.userSelection});200===e.status&&e.data.length>0&&(this.templateCollections=e.data)}catch(e){console.log(e)}},async updateCustomTemplate(e){const t=await(0,d.Z)(e,this.templateSelectedAsset);this.templateAssets=[t],await this.$store.dispatch("product/setTemplateSelection",{templateSelectedAsset:t,collectionId:this.templateSelectedCollection})},async loadTemplates(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.fetchingTemplates=!0,await this.getTemplateCollections(),await this.getTemplateAssets(e,t,s),this.isFirstValidation=!1,this.$nextTick((()=>{this.fetchingTemplates=!1}))},forceTemplatesAssetsRefresh(){var e,t;this.loadTemplates(null===(e=this.templateSelectedAsset)||void 0===e?void 0:e.collectionId,null===(t=this.templateSelectedAsset)||void 0===t?void 0:t.id,!0)}},watch:{fetchingTemplates(e){this.$emit("fetchingTemplates",e)},async customTemplateUds(e){null!=e&&e.url&&await this.updateCustomTemplate(null==e?void 0:e.url)},async editViewTemplateData(e,t){e!==t&&void 0===e&&await this.restoreDefaultCustomTemplate()}},created(){if(this.isEditView){var e,t;this.editViewGalleryId=null===(e=this.editViewTemplateData)||void 0===e?void 0:e.collectionId,this.editViewTemplateId=null===(t=this.editViewTemplateData)||void 0===t?void 0:t.id;const s=this.$watch("editViewTemplateData",(e=>{this.editViewGalleryId=null==e?void 0:e.collectionId,this.editViewTemplateId=null==e?void 0:e.id,s()}))}this.$watch("completeSelection",(async e=>{if(o()(this.prevUserSelection)===o()(e))return;let t,s;var i,l,a,n;(this.prevUserSelection=e,this.isFirstValidation&&this.customConfigurationItem)?(t=null===(i=this.customConfigurationItem)||void 0===i||null===(l=i.templateConfig)||void 0===l?void 0:l.collectionId,s=null===(a=this.customConfigurationItem)||void 0===a||null===(n=a.templateConfig)||void 0===n?void 0:n.id):this.isFirstValidation&&this.editViewTemplateData&&(t=this.editViewGalleryId,s=this.editViewTemplateId);await this.loadTemplates(t,s)}))}};const u=(0,s(51900).Z)(h,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.hasDesignSelection?s("div",[s("template-select",{attrs:{selections:e.templateCollections,value:e.templateSelectedCollection,"custom-style":e.customStyle},on:{selectChanged:e.onTemplateSelectionChanged}}),e._v(" "),e.isCustomTemplateSelected?e._e():s("template-gallery",{attrs:{selections:e.templateAssets,value:e.templateSelectedAsset,validating:e.validating,"is-loading":e.loadingTemplateAssets,"custom-style":e.customStyle},on:{galleryChanged:e.onTemplateAssetChanged}})],1):e._e()}),[],!1,null,"f186814c",null).exports}}]);